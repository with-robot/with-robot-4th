<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– ë¡œë´‡ ì œì–´íŒ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }
        .control-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 20px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        button:active {
            transform: translateY(0);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-up { grid-column: 2; background: #4CAF50; color: white; }
        .btn-left { grid-column: 1; grid-row: 2; background: #2196F3; color: white; }
        .btn-stop { grid-column: 2; grid-row: 2; background: #f44336; color: white; }
        .btn-right { grid-column: 3; grid-row: 2; background: #2196F3; color: white; }
        .btn-down { grid-column: 2; grid-row: 3; background: #4CAF50; color: white; }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .btn-action {
            background: #FF9800;
            color: white;
            padding: 15px;
        }
        .status {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 0.9em;
        }
        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            margin-top: 10px;
        }
        .log-entry {
            margin: 2px 0;
        }
        .coordinates {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        .btn-go {
            grid-column: span 3;
            background: #9C27B0;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– ë¡œë´‡ ì œì–´íŒ</h1>

        <div class="status">
            <div>ğŸ“¡ ìƒíƒœ: <span id="status">ì—°ê²° í™•ì¸ ì¤‘...</span></div>
            <div>ğŸ“ ëª©í‘œ ìœ„ì¹˜: X=<span id="x">0.00</span>m, Y=<span id="y">0.00</span>m, Î¸=<span id="theta">0.00</span>rad</div>
            <div class="log" id="log"></div>
        </div>

        <h3>ë°©í–¥ ì œì–´</h3>
        <div class="control-grid">
            <button class="btn-up" onclick="move('forward')">â¬†ï¸<br>ì•ìœ¼ë¡œ</button>
            <button class="btn-left" onclick="move('left')">â¬…ï¸<br>ì¢ŒíšŒì „</button>
            <button class="btn-stop" onclick="move('home')">ğŸ <br>ì›ì </button>
            <button class="btn-right" onclick="move('right')">â¡ï¸<br>ìš°íšŒì „</button>
            <button class="btn-down" onclick="move('backward')">â¬‡ï¸<br>ë’¤ë¡œ</button>
        </div>

        <h3>ë¹ ë¥¸ ë™ì‘</h3>
        <div class="action-buttons">
            <button class="btn-action" onclick="pattern('square')">ğŸ”² ì‚¬ê°í˜•</button>
            <button class="btn-action" onclick="pattern('triangle')">ğŸ”º ì‚¼ê°í˜•</button>
            <button class="btn-action" onclick="pattern('rotate')">ğŸ”„ íšŒì „</button>
            <button class="btn-action" onclick="pattern('test')">ğŸ§ª í…ŒìŠ¤íŠ¸</button>
        </div>

        <h3>ì¢Œí‘œ ì´ë™</h3>
        <div class="coordinates">
            <input type="number" id="input-x" placeholder="X" step="0.1" value="1.0">
            <input type="number" id="input-y" placeholder="Y" step="0.1" value="0.0">
            <input type="number" id="input-theta" placeholder="Î¸ (rad)" step="0.1" value="0">
            <button class="btn-go" onclick="moveToCoords()">ğŸ¯ ì´ë™í•˜ê¸°</button>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8800/send_action';
        let currentX = 0, currentY = 0, currentTheta = 0;
        const STEP = 0.5;
        const ROTATE = Math.PI / 2;

        // ë¡œê·¸ ì¶”ê°€
        function addLog(message) {
            const logEl = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            logEl.insertBefore(entry, logEl.firstChild);

            // ìµœëŒ€ 20ê°œê¹Œì§€ë§Œ ìœ ì§€
            while (logEl.children.length > 20) {
                logEl.removeChild(logEl.lastChild);
            }
        }

        // ì„œë²„ ì—°ê²° í™•ì¸
        async function checkStatus() {
            try {
                const response = await fetch('http://localhost:8800/');
                if (response.ok) {
                    document.getElementById('status').textContent = 'âœ… ì—°ê²°ë¨';
                    document.getElementById('status').style.color = 'green';
                    addLog('ì„œë²„ ì—°ê²° í™•ì¸ë¨');
                } else {
                    document.getElementById('status').textContent = 'âŒ ì˜¤ë¥˜';
                    document.getElementById('status').style.color = 'red';
                }
            } catch {
                document.getElementById('status').textContent = 'âŒ ì—°ê²° ì•ˆë¨';
                document.getElementById('status').style.color = 'red';
                addLog('ì„œë²„ ì—°ê²° ì‹¤íŒ¨!');
            }
        }

        // ëª…ë ¹ ì „ì†¡
        async function sendCommand(code, description) {
            addLog(`ğŸ“¤ ì „ì†¡: ${description}`);
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: {
                            type: 'run_code',
                            payload: { code: code }
                        }
                    })
                });
                if (response.ok) {
                    addLog(`âœ… ì„±ê³µ: ${description}`);
                    return true;
                } else {
                    addLog(`âŒ ì‹¤íŒ¨: ${description}`);
                    return false;
                }
            } catch (error) {
                console.error('Error:', error);
                addLog(`âŒ ì˜¤ë¥˜: ${error.message}`);
                alert('âŒ ëª…ë ¹ ì „ì†¡ ì‹¤íŒ¨! ì‹œë®¬ë ˆì´í„°ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
                return false;
            }
        }

        // ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        function updatePosition(x, y, theta) {
            currentX = x;
            currentY = y;
            currentTheta = theta;
            document.getElementById('x').textContent = x.toFixed(2);
            document.getElementById('y').textContent = y.toFixed(2);
            document.getElementById('theta').textContent = theta.toFixed(2);
        }

        // ë°©í–¥ ì œì–´
        async function move(direction) {
            let x = currentX, y = currentY, theta = currentTheta;
            let desc = '';

            switch(direction) {
                case 'forward':
                    x += STEP * Math.cos(theta);
                    y += STEP * Math.sin(theta);
                    desc = `ì•ìœ¼ë¡œ ${STEP}m`;
                    break;
                case 'backward':
                    x -= STEP * Math.cos(theta);
                    y -= STEP * Math.sin(theta);
                    desc = `ë’¤ë¡œ ${STEP}m`;
                    break;
                case 'left':
                    theta += ROTATE;
                    desc = 'ì¢ŒíšŒì „ 90Â°';
                    break;
                case 'right':
                    theta -= ROTATE;
                    desc = 'ìš°íšŒì „ 90Â°';
                    break;
                case 'home':
                    x = y = theta = 0;
                    desc = 'ì›ì  ë³µê·€';
                    break;
            }

            const code = `print("ğŸ¤– ${desc}"); set_target_position(${x.toFixed(3)}, ${y.toFixed(3)}, ${theta.toFixed(3)}, wait=True); print("âœ… ë„ì°©!")`;
            if (await sendCommand(code, desc)) {
                updatePosition(x, y, theta);
            }
        }

        // íŒ¨í„´ ë™ì‘
        async function pattern(type) {
            let code = '';
            let desc = '';

            switch(type) {
                case 'square':
                    desc = 'ì‚¬ê°í˜• ê²½ë¡œ';
                    code = `
print("ğŸ”² ì‚¬ê°í˜• ì‹œì‘")
set_target_position(1, 0, 0, wait=True)
print("  1/4 ì™„ë£Œ")
set_target_position(1, 1, 1.57, wait=True)
print("  2/4 ì™„ë£Œ")
set_target_position(0, 1, 3.14, wait=True)
print("  3/4 ì™„ë£Œ")
set_target_position(0, 0, -1.57, wait=True)
print("âœ… ì‚¬ê°í˜• ì™„ë£Œ!")
`;
                    break;
                case 'triangle':
                    desc = 'ì‚¼ê°í˜• ê²½ë¡œ';
                    code = `
print("ğŸ”º ì‚¼ê°í˜• ì‹œì‘")
set_target_position(1, 0, 0, wait=True)
print("  1/3 ì™„ë£Œ")
set_target_position(0.5, 0.866, 2.094, wait=True)
print("  2/3 ì™„ë£Œ")
set_target_position(0, 0, 0, wait=True)
print("âœ… ì‚¼ê°í˜• ì™„ë£Œ!")
`;
                    break;
                case 'rotate':
                    desc = 'ì œìë¦¬ íšŒì „';
                    code = `
print("ğŸ”„ íšŒì „ ì‹œì‘")
for i in range(9):
    angle = 3.14159 * i / 4
    set_target_position(0, 0, angle, wait=True)
    if i % 2 == 0:
        print(f"  ì§„í–‰: {i}/8")
print("âœ… íšŒì „ ì™„ë£Œ!")
`;
                    break;
                case 'test':
                    desc = 'ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸';
                    code = `
print("ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œì‘")
set_target_position(0.5, 0, 0, wait=True)
print("  â†’ ì•ìœ¼ë¡œ")
set_target_position(0.5, 0.5, 1.57, wait=True)
print("  â†’ ì™¼ìª½")
set_target_position(0, 0, 0, wait=True)
print("âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ!")
`;
                    break;
            }

            await sendCommand(code, desc);
            updatePosition(0, 0, 0);
        }

        // ì¢Œí‘œ ì´ë™
        async function moveToCoords() {
            const x = parseFloat(document.getElementById('input-x').value);
            const y = parseFloat(document.getElementById('input-y').value);
            const theta = parseFloat(document.getElementById('input-theta').value);

            const code = `print("ğŸ¯ ì¢Œí‘œ ì´ë™: (${x}, ${y}, ${theta})"); set_target_position(${x}, ${y}, ${theta}, wait=True); print("âœ… ë„ì°©!")`;
            if (await sendCommand(code, `ì¢Œí‘œ (${x.toFixed(2)}, ${y.toFixed(2)}, ${theta.toFixed(2)})`)) {
                updatePosition(x, y, theta);
            }
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT') return; // ì…ë ¥ í•„ë“œì—ì„œëŠ” ë¬´ì‹œ

            switch(e.key) {
                case 'ArrowUp': move('forward'); e.preventDefault(); break;
                case 'ArrowDown': move('backward'); e.preventDefault(); break;
                case 'ArrowLeft': move('left'); e.preventDefault(); break;
                case 'ArrowRight': move('right'); e.preventDefault(); break;
                case 'h': case 'H': move('home'); break;
            }
        });

        // ì´ˆê¸°í™”
        addLog('ğŸš€ ì›¹ ì œì–´íŒ ì‹œì‘');
        checkStatus();
        setInterval(checkStatus, 5000);
    </script>
</body>
</html>
